$(document).ready(function(){var a=function(){var a=window.location.search,c=new Array;c=a.replace("?","").split("&");var d=c[0].split("=")[1],e=c[1].split("=")[1],f=$.ajax({method:"GET",url:"/back-office/messages/"+d+"/"+e+"/all",dataType:"json"});f.done(function(a){_NumberOfMessages=0,b(a)}),f.fail(function(a,b){Materialize.toast("Impossible de récupérer les messages",4e3)})};$('input[name="usermessage"]').keypress(function(a){13==a.which&&$("#send-message").click()}),$("#user-connecte").click(function(){var a=window.location.search,b=new Array;b=a.replace("?","").split("&");var c=b[0].split("=")[1],d=b[1].split("=")[1];window.location="/ajax/ajax_user_connecte.html?salon="+c+"&user="+d}),$("#modify-last-modal-submit").click(function(){var a=window.location.search,b=new Array;b=a.replace("?","").split("&");var c=b[0].split("=")[1],d=b[1].split("=")[1],e=$("#modify-last-input").val();if(""!==d.trim()&&""!==c.trim()&&""!==e.trim()){var f=$.ajax({method:"PUT",url:"/back-office/messages/"+c+"/"+d+"/modify",dataType:"json",contentType:"json",data:{message:e}});f.done(function(a){leanModalAction("#modify-last-modal","close",!0),Materialize.toast("Message modifié avec succès",4e3)}),f.fail(function(a,b){leanModalAction("#modify-last-modal","close",!0),Materialize.toast("Echec de la modification du Message (PUT)",4e3),console.log(a.responseText)})}}),$("#add-pseudo-modal-submit").click(function(){var a=window.location.search,b=new Array;b=a.replace("?","").split("&");var c=b[0].split("=")[1],d=b[1].split("=")[1],e=$("#add-pseudo-input").val();if(""!==d.trim()&&""!==c.trim()&&""!==e.trim()){var f=$.ajax({method:"POST",url:"/back-office/users/add/"+c+"/"+d,dataType:"json",data:{user:e}});f.done(function(a){leanModalAction("#add-pseudo-modal","close",!0),Materialize.toast("Utilisateur ajouté avec succès",4e3)}),f.fail(function(a,b){leanModalAction("#add-pseudo-modal","close",!0),Materialize.toast("Impossible d'ajouter l'utilisateur",4e3),console.log(a.responseText)})}}),$("#delete-last").click(function(){var a=window.location.search,b=new Array;b=a.replace("?","").split("&");var c=b[0].split("=")[1],d=b[1].split("=")[1];if(""!==d.trim()&&""!==c.trim()){var e=$.ajax({method:"DELETE",url:"/back-office/messages/"+c+"/"+d+"/delete"});e.done(function(a){window.location.href=window.location.href,leanModalAction("#modify-last-modal","close",!0),Materialize.toast("Dernier Message supprimé avec succès",4e3)}),e.fail(function(a,b){leanModalAction("#modify-last-modal","close",!0),Materialize.toast("Echec de la suppression du Message (DELETE)",4e3),console.log(a.responseText)})}}),$("#send-message").click(function(){var a=window.location.search,b=new Array;b=a.replace("?","").split("&");var d=b[0].split("=")[1],e=b[1].split("=")[1],f=$('input[name="usermessage"]').val();if($('input[name="usermessage"]').val(""),""!==e.trim()&&""!==d.trim()&&""!==f.trim()){var g=$.ajax({method:"POST",url:"/back-office/messages/"+d+"/"+e+"/add",dataType:"json",data:{user:e,salon:d,usermessage:f}});g.done(function(a){c(a)}),g.fail(function(a,b){Materialize.toast("Echec de l'envoi du message",4e3),console.log(a.responseText)})}});var b=function(a){var b="",c=0;$("#message-wrapper div:last").length&&(c=$("#message-wrapper div:last").attr("id"),c=parseInt(c),c+=1);for(var d=a.user,e=a.messagesList,f=0;f<e.length;f++){var g=e[f];_NumberOfMessages+=1;var h="";g.user!=d&&(h="other-user"),b+=' <div id="'+_NumberOfMessages+' " class="received-message '+h+' z-depth-1">\n      <span>'+g.user+"</span>\n      <p>"+g.message+"</p>\n    </div>"}$(".messages-wrapper").length&&($("#message-wrapper").append(b),$(".messages-wrapper").scrollTop($(".messages-wrapper")[0].scrollHeight))},c=function(a){var c=(a.user,a.messagesList.length-1),d=a.messagesList[c],e=$(' <div id="'+(c+1)+' " class="received-message z-depth-1">\n      <span>'+d.user+"</span>\n      <p>"+d.message+"</p>\n    </div>");$(".messages-wrapper").length&&($("#message-wrapper").append(e),_NumberOfMessages+=1,$(".messages-wrapper").scrollTop($(".messages-wrapper")[0].scrollHeight))},d=function(){var a=window.location.search,c=new Array;c=a.replace("?","").split("&");var d=c[0].split("=")[1],e=c[1].split("=")[1],f=$.ajax({method:"GET",url:"/back-office/messages/"+d+"/"+e+"/message-number",dataType:"json"});f.done(function(a){if(a.number>_NumberOfMessages){var c=$.ajax({method:"GET",url:"/back-office/messages/"+d+"/"+e+"/get-from-"+(_NumberOfMessages+1),dataType:"json"});c.done(function(a){b(a)}),c.fail(function(a,b){Materialize.toast("Impossible de récupérer les derniers messages",4e3)})}}),f.fail(function(a,b){Materialize.toast("Impossible de récupérer le nombre de messages",4e3)})};$(document).keyup(function(a){27==a.keyCode&&leanModalAction(".modal","close",!0)});var e=function(a){$("#open-"+a).on("click",function(){leanModalAction("#"+a+"-modal","open",!0)}),$("#"+a+"-close").click(function(){leanModalAction("#"+a+"-modal","close",!0)})};e("modify-last"),e("add-pseudo"),a(),setInterval(d,5e3)});